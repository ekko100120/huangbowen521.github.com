
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>翻译-使用Ratpack和Spring Boot打造高性能的JVM微服务应用 - 黄博文的地盘</title>
  <meta name="author" content="黄博文">

  
  <meta name="description" content="这是我为InfoQ翻译的文章，原文地址:Build High Performance JVM Microservices with Ratpack &amp; Spring Boot,InfoQ上的中文地址:使用Ratpack与Spring Boot构建高性能JVM微服务。 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.huangbowen.net/blog/2016/02/23/ratpack-and-spring-boot">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="黄博文的地盘" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/libs/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->

<style>#forkongithub a{background:#060;color:#fff;text-decoration:none;font-family:arial, sans-serif;text-align:center;font-weight:bold;padding:5px 40px;font-size:1rem;line-height:2rem;position:relative;transition:0.5s;}#forkongithub a:hover{background:#A853B2;color:#fff;}#forkongithub a::before,#forkongithub a::after{content:"";width:100%;display:block;position:absolute;top:1px;left:0;height:1px;background:#fff;}#forkongithub a::after{bottom:1px;top:auto;}@media screen and (min-width:800px){#forkongithub{position:absolute;display:block;top:0;right:0;width:200px;overflow:hidden;height:200px;}#forkongithub a{width:200px;position:absolute;top:60px;right:-60px;transform:rotate(45deg);-webkit-transform:rotate(45deg);box-shadow:4px 4px 10px rgba(0,0,0,0.8);}}</style><span id="forkongithub"><a href="https://github.com/huangbowen521">Fork me on GitHub</a></span>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-38174207-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">黄博文的地盘</a></h1>
  
    <h2>我是一个程序员.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.huangbowen.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">翻译-使用Ratpack和Spring Boot打造高性能的JVM微服务应用</h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-02-23T16:47:48+08:00" pubdate data-updated="true">Feb 23<span>rd</span>, 2016</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://www.huangbowen.net">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>这是我为InfoQ翻译的文章，原文地址:<a href="http://www.infoq.com/articles/Ratpack-and-Spring-Boot">Build High Performance JVM Microservices with Ratpack &amp; Spring Boot</a>,InfoQ上的中文地址:<a href="http://www.infoq.com/cn/articles/Ratpack-and-Spring-Boot">使用Ratpack与Spring Boot构建高性能JVM微服务</a>。</p>

<p>在微服务天堂中Ratpack和Spring Boot是天造地设的一对。它们都是以开发者为中心的运行于JVM之上的web框架，侧重于生产率、效率以及轻量级部署。他们在服务程序的开发中带来了各自的好处。Ratpack通过一个高吞吐量、非阻塞式的web层提供了一个反应式编程模型，而且对应用程序结构的定义和HTTP请求过程提供了一个便利的处理程序链；Spring Boot集成了整个Spring生态系统，为应用程序提供了一种简单的方式来配置和启用组件。Ratpack和Spring Boot是构建原生支持计算云的基于数据驱动的微服务的不二选择。</p>

<!-- more -->


<p>Ratpack并不关心应用程序底层使用了什么样的依赖注入框架。相反，应用程序可以通过Ratpack提供的DI抽象（被称为Registry）访问服务层组件。Ratpack的Registry是构成其基础设施的一部分，其提供了一个接口，DI提供者可以使用注册器回调（registry backing）机制来参与到组件解决方案序列中。</p>

<p>Ratpack直接为Guice和Spring Boot提供了注册器回调机制，开发人员可以为应用程序灵活选择使用的依赖注入框架。</p>

<p>在本文中我们将演示使用Ratpack和Spring Boot构建一个RESTful风格的基于数据驱动的微服务，背后使用了Spring Data用于操作数据。</p>

<p>开始构建Ratpack项目的最佳方式是创建Gradle脚本以及标准的Java项目结构。Gradle是Ratpack原生支持的构建系统，其实由于Ratpack只是一组简单的JVM库，所以其实它适用于任何构建系统（不管你的需求有多特别）。如果你还未安装Gradle，那么安装它最佳方式是通过<a href="http://gvmtool.net/">Groovy enVironment Manager工具</a>。示例项目的构建脚本如列表1所示。</p>

<p>列表1</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">buildscript</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">repositories</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">jcenter</span><span class="o">()</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">classpath</span> <span class="s1">&#39;io.ratpack:ratpack-gradle:0.9.18&#39;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">&#39;io.ratpack.ratpack-java&#39;</span>
</span><span class='line'><span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">&#39;idea&#39;</span>
</span><span class='line'><span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">&#39;eclipse&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">repositories</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">jcenter</span><span class="o">()</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">compile</span> <span class="n">ratpack</span><span class="o">.</span><span class="na">dependency</span><span class="o">(</span><span class="s1">&#39;spring-boot&#39;</span><span class="o">)</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">mainClassName</span> <span class="o">=</span> <span class="s2">&quot;springpack.Main&quot;</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">eclipse</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">classpath</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">containers</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="s1">&#39;org.eclipse.jdt.launching.JRE_CONTAINER&#39;</span><span class="o">)</span>
</span><span class='line'>    <span class="n">containers</span> <span class="s1">&#39;org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.8&#39;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>在(1)部分中，构建脚本通过调用Ratpack Gradle插件的ratpack.dependency(..)方法引入了Ratpack和Spring Boot的集成。根据构建脚本和当前项目结构，我们可以创建一个“主类”(main class)，其作为可运行的类来启动和运行应用程序。注意（2）中我们指定了主类的名称，所以使用命令行工具时会更简练。这意味着实际的主类名必须与之一致，所以需要在本项目的src/main/java目录中创建一个名为springpack.Main的类。</p>

<p>在主类中，我们通过工厂方法构造了RatpackServer的一个实例，在start方法中提供了对应用程序的定义。该定义中我们编写了RESTful API处理器链。请参见列表2中对Main类的演示。注意Ratpack要求的编译环境为Java 8。</p>

<p>列表2</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">springpack</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">ratpack.server.RatpackServer</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">RatpackServer</span><span class="o">.</span><span class="na">start</span><span class="o">(</span><span class="n">spec</span> <span class="o">-&gt;</span> <span class="n">spec</span>
</span><span class='line'>      <span class="o">.</span><span class="na">handlers</span><span class="o">(</span><span class="n">chain</span> <span class="o">-&gt;</span> <span class="n">chain</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span>
</span><span class='line'>          <span class="o">.</span><span class="na">prefix</span><span class="o">(</span><span class="s">&quot;api&quot;</span><span class="o">,</span> <span class="n">pchain</span> <span class="o">-&gt;</span> <span class="n">pchain</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span>
</span><span class='line'>            <span class="o">.</span><span class="na">all</span><span class="o">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="n">ctx</span> <span class="o">(</span><span class="mi">3</span><span class="o">)</span>
</span><span class='line'>              <span class="o">.</span><span class="na">byMethod</span><span class="o">(</span><span class="n">method</span> <span class="o">-&gt;</span> <span class="n">method</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span>
</span><span class='line'>                <span class="o">.</span><span class="na">get</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="s">&quot;Received GET request&quot;</span><span class="o">))</span>
</span><span class='line'>                <span class="o">.</span><span class="na">post</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="s">&quot;Received POST request&quot;</span><span class="o">))</span>
</span><span class='line'>                <span class="o">.</span><span class="na">put</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="s">&quot;Received PUT request&quot;</span><span class="o">))</span>
</span><span class='line'>                <span class="o">.</span><span class="na">delete</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="s">&quot;Received DELETE request&quot;</span><span class="o">))</span>
</span><span class='line'>              <span class="o">)</span>
</span><span class='line'>            <span class="o">)</span>
</span><span class='line'>          <span class="o">)</span>
</span><span class='line'>      <span class="o">)</span>
</span><span class='line'>    <span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果我们仔细剖析主类中的应用程序定义，我们可以识别出一些关键知识点，对于不熟悉Ratpack的人来说，我们需要对这些知识点做进一步解释。第一个值得注意的点在（1）中处理器区域定义了一个处理器链，该处理器链用于处理Ratpack流中的HTTP请求。通过链式定义的处理器描述了它们能够处理的请求类型。特别在（2）中我们定义了一个前缀处理器类型，指定它被绑定到“api”这个HTTP路由。前缀处理器创建了一个新的处理器链，用来处理匹配”/api” 端口(endpoint)到来的请求。在（3）处我们使用了所有的处理器类型来指定所有到来的请求应该运行在我们提供的处理器中，在（4）处我们使用Ratpack的byMethod机制来将get，post，put和delete处理器绑定到到各自的HTTP方法中。</p>

<p>在项目根目录下，我们可以通过命令行简单使用gradle的“run”命令运行该应用程序。这会启动web服务器并绑定到端口5050。为了演示当前项目的功能，确保处理器结构工作正常，我们可以在命令行中通过curl运行一些测试：</p>

<ul>
<li>命令：curl <a href="http://localhost:5050,">http://localhost:5050,</a> 期待输出：Received GET request</li>
<li>命令：curl -XPOST <a href="http://localhost:5050,">http://localhost:5050,</a> 期待输出：Received POST request</li>
<li>命令：curl -XPUT <a href="http://localhost:5050,">http://localhost:5050,</a> 期待输出：Received PUT request</li>
<li>命令：curl -XDELETE <a href="http://localhost:5050,">http://localhost:5050,</a> 期待输出：Received DELETE request</li>
</ul>


<p>可以看到，应用程序处理器链可以正确地路由请求，我们建立了RESTful API的结构。接下来需要改善这些API&hellip;</p>

<p>为了演示的缘故，让我们尽量保持简单，改造该微服务以便可以对一个User领域对象进行CRUD操作。通过REST接口，客户可以做以下事情：</p>

<ul>
<li>通过一个GET请求来请求指定的用户账号，用户名作为路径变量（path variable）；</li>
<li>GET请求中如果未指定用户名，则列出所有的用户；</li>
<li>通过POST一个JSON格式的用户对象来创建一个用户；</li>
<li>使用PUT请求，用户名作为路径变量来更新该用户的邮件地址；</li>
<li>使用DELETE请求，用户名作为路径变量来删除该用户。</li>
</ul>


<p>在之前小节中我们定义的处理器已经包含了大多数处理这种需求的基础设施。但根据需求我们还需要做细微调整。例如，我们现在需要绑定处理器接收用户名作为路径变量。列表3中是更新后的代码，主类中的处理器可以满足现在的需求。</p>

<p>列表3</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">springpack</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">ratpack.server.RatpackServer</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">RatpackServer</span><span class="o">.</span><span class="na">start</span><span class="o">(</span><span class="n">spec</span> <span class="o">-&gt;</span> <span class="n">spec</span>
</span><span class='line'>      <span class="o">.</span><span class="na">handlers</span><span class="o">(</span><span class="n">chain</span> <span class="o">-&gt;</span> <span class="n">chain</span>
</span><span class='line'>        <span class="o">.</span><span class="na">prefix</span><span class="o">(</span><span class="s">&quot;api/users&quot;</span><span class="o">,</span> <span class="n">pchain</span> <span class="o">-&gt;</span> <span class="n">pchain</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span>
</span><span class='line'>          <span class="o">.</span><span class="na">prefix</span><span class="o">(</span><span class="s">&quot;:username&quot;</span><span class="o">,</span> <span class="n">uchain</span> <span class="o">-&gt;</span> <span class="n">uchain</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span>
</span><span class='line'>            <span class="o">.</span><span class="na">all</span><span class="o">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="o">(</span><span class="mi">3</span><span class="o">)</span>
</span><span class='line'>              <span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getPathTokens</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;username&quot;</span><span class="o">);</span>
</span><span class='line'>              <span class="n">ctx</span><span class="o">.</span><span class="na">byMethod</span><span class="o">(</span><span class="n">method</span> <span class="o">-&gt;</span> <span class="n">method</span> <span class="o">(</span><span class="mi">4</span><span class="o">)</span>
</span><span class='line'>                <span class="o">.</span><span class="na">get</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="s">&quot;Received request for user: &quot;</span> <span class="o">+</span> <span class="n">username</span><span class="o">))</span>
</span><span class='line'>                                              <span class="o">.</span><span class="na">put</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class='line'>                  <span class="n">String</span> <span class="n">json</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getRequest</span><span class="o">().</span><span class="na">getBody</span><span class="o">().</span><span class="na">getText</span><span class="o">();</span>
</span><span class='line'>                  <span class="n">ctx</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="s">&quot;Received update request for user: &quot;</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s">&quot;, JSON: &quot;</span> <span class="o">+</span> <span class="n">json</span><span class="o">);</span>
</span><span class='line'>                <span class="o">})</span>
</span><span class='line'>                <span class="o">.</span><span class="na">delete</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="s">&quot;Received delete request for user: &quot;</span> <span class="o">+</span> <span class="n">username</span><span class="o">))</span>
</span><span class='line'>              <span class="o">);</span>
</span><span class='line'>            <span class="o">})</span>
</span><span class='line'>          <span class="o">)</span>
</span><span class='line'>          <span class="o">.</span><span class="na">all</span><span class="o">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="n">ctx</span> <span class="o">(</span><span class="mi">5</span><span class="o">)</span>
</span><span class='line'>            <span class="o">.</span><span class="na">byMethod</span><span class="o">(</span><span class="n">method</span> <span class="o">-&gt;</span> <span class="n">method</span>
</span><span class='line'>              <span class="o">.</span><span class="na">post</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span> <span class="o">(</span><span class="mi">6</span><span class="o">)</span>
</span><span class='line'>                <span class="n">String</span> <span class="n">json</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getRequest</span><span class="o">().</span><span class="na">getBody</span><span class="o">().</span><span class="na">getText</span><span class="o">();</span>
</span><span class='line'>                <span class="n">ctx</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="s">&quot;Received request to create a new user with JSON: &quot;</span> <span class="o">+</span> <span class="n">json</span><span class="o">);</span>
</span><span class='line'>              <span class="o">})</span>
</span><span class='line'>              <span class="o">.</span><span class="na">get</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="s">&quot;Received request to list all users&quot;</span><span class="o">))</span> <span class="o">(</span><span class="mi">7</span><span class="o">)</span>
</span><span class='line'>            <span class="o">)</span>
</span><span class='line'>          <span class="o">)</span>
</span><span class='line'>        <span class="o">)</span>
</span><span class='line'>      <span class="o">)</span>
</span><span class='line'>    <span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>重新构造后的API遵循了面向资源的模式，围绕着user领域对象为中心。以下是一些修改点：</p>

<ul>
<li>在（1）中我们修改了入口级前缀为/api/users；</li>
<li>在（2）中我们绑定了一个新的前缀处理器到:username路径变量上。任何到来的请求路径中的值会被转换，并且Ratpack处理器可以通过ctx.getPathTokens()中的表来访问该值。</li>
<li>在（3）中我们为所有匹配/api/users/:username URI模式的请求绑定一个处理器；
*（4）中我们使用byMethod机制来为HTTP GET，PUT和DELETE方法绑定处理器。通过这些处理器我们可以了解客户端对指定用户的操作意图。在PUT处理器中，我们调用ctx.getRequest().getBody().getText()方法来捕获到来的请求中的JSON数据；</li>
<li>在（5）中我们附加一个处理器来匹配所有从/api/users端口到来的请求；</li>
<li>在（6）中我们对/api/users处理器使用byMethod机制来附加一个POST处理器，当创建新用户时该POST处理器会被调用。这里又一次从到来的请求中取出JSON数据；</li>
<li>最后在（7）中，我们附加了一个GET处理器，当客户端需要所有用户的列表时可以调用它。</li>
</ul>


<p>再次启动该应用程序并进行一系列curl命令行调用，来测试这些端口操作是否符合预期：</p>

<ul>
<li>命令：curl <a href="http://localhost:5050/api/users,">http://localhost:5050/api/users,</a> 期望结果：&#8221;Received request to list all users&#8221;</li>
<li>命令: curl -d &lsquo;{ &ldquo;username&rdquo;: &ldquo;dan&rdquo;, &ldquo;email&rdquo;: &ldquo;<a href="&#x6d;&#x61;&#x69;&#108;&#116;&#x6f;&#58;&#x64;&#97;&#110;&#105;&#101;&#108;&#x70;&#x77;&#111;&#111;&#100;&#x73;&#x40;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#x6d;">&#100;&#97;&#110;&#x69;&#x65;&#108;&#112;&#x77;&#x6f;&#x6f;&#x64;&#x73;&#x40;&#x67;&#109;&#x61;&#x69;&#108;&#x2e;&#x63;&#111;&#x6d;</a>&rdquo; }&#8217;<a href="http://localhost:5050/api/users,">http://localhost:5050/api/users,</a> 期望结果: &ldquo;Received request to create a new user with JSON: { &#8220;username&rdquo;: &ldquo;dan&rdquo;, &ldquo;email&rdquo;: &ldquo;<a href="&#x6d;&#97;&#x69;&#108;&#116;&#111;&#58;&#100;&#x61;&#110;&#105;&#x65;&#x6c;&#112;&#119;&#x6f;&#x6f;&#x64;&#115;&#64;&#103;&#109;&#x61;&#105;&#x6c;&#46;&#x63;&#111;&#x6d;">&#x64;&#x61;&#x6e;&#x69;&#x65;&#x6c;&#x70;&#x77;&#x6f;&#111;&#100;&#x73;&#64;&#x67;&#109;&#97;&#x69;&#108;&#x2e;&#99;&#111;&#x6d;</a>&rdquo; }&#8221;</li>
<li>命令: curl <a href="http://localhost:5050/api/users/dan,">http://localhost:5050/api/users/dan,</a> 期望结果: &ldquo;Received request for user: dan&rdquo;</li>
<li>命令: curl -XPUT -d &lsquo;{ &ldquo;email&rdquo;: &ldquo;<a href="&#x6d;&#97;&#x69;&#x6c;&#x74;&#x6f;&#58;&#100;&#x61;&#x6e;&#x69;&#101;&#108;&#46;&#x70;&#46;&#x77;&#111;&#111;&#x64;&#x73;&#64;&#x67;&#x6d;&#x61;&#105;&#x6c;&#46;&#x63;&#111;&#109;">&#100;&#97;&#x6e;&#x69;&#101;&#108;&#46;&#112;&#x2e;&#x77;&#x6f;&#x6f;&#100;&#115;&#64;&#103;&#x6d;&#97;&#105;&#x6c;&#x2e;&#99;&#111;&#x6d;</a>&rdquo; }&#8217;<a href="http://localhost:5050/api/users/dan,">http://localhost:5050/api/users/dan,</a> 期望结果: &ldquo;Received update request for user: dan, JSON: { &#8220;email&rdquo;: &ldquo;<a href="&#x6d;&#97;&#105;&#108;&#x74;&#111;&#58;&#x64;&#x61;&#x6e;&#x69;&#x65;&#x6c;&#x2e;&#x70;&#x2e;&#119;&#111;&#111;&#100;&#115;&#x40;&#103;&#109;&#x61;&#105;&#x6c;&#x2e;&#x63;&#x6f;&#109;">&#100;&#x61;&#110;&#105;&#x65;&#x6c;&#46;&#112;&#46;&#x77;&#x6f;&#x6f;&#x64;&#115;&#64;&#103;&#x6d;&#97;&#105;&#x6c;&#x2e;&#x63;&#111;&#x6d;</a>&rdquo; }&#8221;</li>
<li>命令: curl -XDELETE <a href="http://localhost:5050/api/users/dan,">http://localhost:5050/api/users/dan,</a> 期望结果: &ldquo;Received delete request for user: dan&rdquo;</li>
</ul>


<p>现在我们拥有了满足需求的API的基础框架，但仍需使其更加有用。我们可以开始设置服务层的依赖。在本例中，我们将使用Spring Data JPA组件作为数据访问对象；列表4展示了对构建脚本的修改。</p>

<p>列表4</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">buildscript</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">repositories</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">jcenter</span><span class="o">()</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">classpath</span> <span class="s1">&#39;io.ratpack:ratpack-gradle:0.9.18&#39;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">&#39;io.ratpack.ratpack-java&#39;</span>
</span><span class='line'><span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">&#39;idea&#39;</span>
</span><span class='line'><span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">&#39;eclipse&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">repositories</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">jcenter</span><span class="o">()</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">compile</span> <span class="n">ratpack</span><span class="o">.</span><span class="na">dependency</span><span class="o">(</span><span class="s1">&#39;spring-boot&#39;</span><span class="o">)</span>
</span><span class='line'>  <span class="n">compile</span> <span class="s1">&#39;org.springframework.boot:spring-boot-starter-data-jpa:1.2.4.RELEASE&#39;</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span>
</span><span class='line'>  <span class="n">compile</span> <span class="s1">&#39;com.h2database:h2:1.4.187&#39;</span> <span class="o">(</span><span class="mi">2</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">mainClassName</span> <span class="o">=</span> <span class="s2">&quot;springpack.Main&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">eclipse</span> <span class="o">{</span>
</span><span class='line'>  <span class="n">classpath</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">containers</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="s1">&#39;org.eclipse.jdt.launching.JRE_CONTAINER&#39;</span><span class="o">)</span>
</span><span class='line'>    <span class="n">containers</span> <span class="s1">&#39;org.eclipse.jdt.launching.JRE_CONTAINER/org.eclipse.jdt.internal.debug.ui.launcher.StandardVMType/JavaSE-1.8&#39;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>在（1）中，我们引入了对Spring Boot Spring Data JPA的依赖，(2)中我们引入了H2嵌入式数据库依赖。总共就这么点修改。当在classpath中发现H2时，Spring Boot将自动配置Spring Data来使用它作为内存数据源。通过<a href="http://projects.spring.io/spring-data-jpa/">该页面</a>可以详细了解如何配置和使用Spring Data数据源。</p>

<p>有了新的依赖后，我们必须做的第一件事是建模我们的微服务领域对象：User。User类为了演示的目的尽可能的简单，列表5展示了一个正确建模的JPA领域实体。我们将其放置到项目的src/main/java/springpack/model/User.java类文件中。</p>

<p>列表5</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">springpack</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">javax.persistence.Column</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Entity</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">1</span><span class="n">l</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Id</span>
</span><span class='line'>  <span class="nd">@GeneratedValue</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">String</span> <span class="n">username</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Column</span><span class="o">(</span><span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
</span><span class='line'>  <span class="kd">private</span> <span class="n">String</span> <span class="n">email</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getUsername</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">username</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUsername</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">this</span><span class="o">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getEmail</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">email</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setEmail</span><span class="o">(</span><span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">this</span><span class="o">.</span><span class="na">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>由于Spring Data已经处于该项目的编译时需要的classpath中，所以我们可以使用javax.persistence.*注解。Spring Boot使用该注解可以实现与数据访问对象一起设置及运行，所以我们可以使用Spring Data的脚手架功能中的Repository服务类型来模块化DAO。由于我们的API相对来说只是直接的CRUD操作，所以我们实现UserRepository DAO时，可以利用Spring Data提供的CrudRepository 固定层来编写尽可能少的代码。</p>

<p>列表6</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">springpack</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.springframework.data.repository.CrudRepository</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.springframework.stereotype.Repository</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Repository</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserRepository</span> <span class="kd">extends</span> <span class="n">CrudRepository</span><span class="o">&lt;</span><span class="n">User</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">User</span> <span class="nf">findByUsername</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">);</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>惊奇的是，列表6中展示的UesrRepository DAO实现短短一行代码已经对User领域对象实现了一个必要的完全成形的服务层。Spring Data提供的Repository接口允许基于我们对搜索的实体的约定创建”helper&#8221;查找方法。根据需求，我们知道API层需要通过用户名查找用户，所以可以在（1）处添加findByUsername方法。我们把该UserRepository放置到项目中的/src/main/java/springpack/model/UserRepository.java类文件中。</p>

<p>在修改API来使用UserRepository之前，我们首先必须定义Spring Boot 应用程序类。该类代表了一个配置入口，指向了Spring Boot自动配置引擎，并且可以构造一个Spring ApplicationContext，从而可以使用Ratpack应用程序中的注册器回调。列表7描述了该Spring Boot配置类。</p>

<p>列表7</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">springpack</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@SpringBootApplication</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringBootConfig</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Bean</span>
</span><span class='line'>  <span class="n">ObjectMapper</span> <span class="nf">objectMapper</span><span class="o">()</span> <span class="o">{</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">new</span> <span class="nf">ObjectMapper</span><span class="o">();</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>SpringBootConfig类中短小精悍的代码放置在src/main/java/springpack/SpringBootConfig.java类文件中。在该类中我们显式地自动配置了Jackson OjbectMapper的Spring bean。我们将在API层使用它来读写JSON数据。</p>

<p>@SpringBootApplication注解做了大部分事情。当初始化Spring Boot注册器回调时，该类会作为入口点。它的基础设施将使用该注解来扫描classpath中任何可用的组件，并自动装配这些组件到应用程序上下文中中，并且根据Spring Boot的约定规则来自动配置它们。例如，UserRepository类（使用了@Repository注解）存在于应用程序classpath中，所以Spring Boot将使用Spring Data引擎代理该接口，并配置其与H2嵌入式数据库一块工作，因为H2也在classpath中。借助Spring Boot我们无需其它多余的配置。</p>

<p>在实现API层之前我们需要做的另一个事情是构造Ratpack来使用Spring Boot应用程序作为注册器。Ratpack的Spring Boot集成组件提供了一个固定层来无缝转换Spring Boot应用程序为注册器回调程序，只需一行代码就可以合并这两个世界。列表8中的代码展示了更新后的主类，这次使用SpringBootConfig类作为API层的注册器。</p>

<p>列表8</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">springpack</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">ratpack.server.RatpackServer</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">ratpack.spring.Spring</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">springpack.config.SpringBootConfig</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">RatpackServer</span><span class="o">.</span><span class="na">start</span><span class="o">(</span><span class="n">spec</span> <span class="o">-&gt;</span> <span class="n">spec</span>
</span><span class='line'>      <span class="o">.</span><span class="na">registry</span><span class="o">(</span><span class="n">Spring</span><span class="o">.</span><span class="na">spring</span><span class="o">(</span><span class="n">SpringBootConfig</span><span class="o">.</span><span class="na">class</span><span class="o">))</span> <span class="o">(</span><span class="mi">1</span><span class="o">)</span>
</span><span class='line'>      <span class="o">.</span><span class="na">handlers</span><span class="o">(</span><span class="n">chain</span> <span class="o">-&gt;</span> <span class="n">chain</span>
</span><span class='line'>        <span class="o">.</span><span class="na">prefix</span><span class="o">(</span><span class="s">&quot;api/users&quot;</span><span class="o">,</span> <span class="n">pchain</span> <span class="o">-&gt;</span> <span class="n">pchain</span>
</span><span class='line'>          <span class="o">.</span><span class="na">prefix</span><span class="o">(</span><span class="s">&quot;:username&quot;</span><span class="o">,</span> <span class="n">uchain</span> <span class="o">-&gt;</span> <span class="n">uchain</span>
</span><span class='line'>            <span class="o">.</span><span class="na">all</span><span class="o">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getPathTokens</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;username&quot;</span><span class="o">);</span>
</span><span class='line'>              <span class="n">ctx</span><span class="o">.</span><span class="na">byMethod</span><span class="o">(</span><span class="n">method</span> <span class="o">-&gt;</span> <span class="n">method</span>
</span><span class='line'>                <span class="o">.</span><span class="na">get</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="s">&quot;Received request for user: &quot;</span> <span class="o">+</span> <span class="n">username</span><span class="o">))</span>
</span><span class='line'>                <span class="o">.</span><span class="na">put</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class='line'>                  <span class="n">String</span> <span class="n">json</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getRequest</span><span class="o">().</span><span class="na">getBody</span><span class="o">().</span><span class="na">getText</span><span class="o">();</span>
</span><span class='line'>                  <span class="n">ctx</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="s">&quot;Received update request for user: &quot;</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s">&quot;, JSON: &quot;</span> <span class="o">+</span> <span class="n">json</span><span class="o">);</span>
</span><span class='line'>                <span class="o">})</span>
</span><span class='line'>                <span class="o">.</span><span class="na">delete</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="s">&quot;Received delete request for user: &quot;</span> <span class="o">+</span> <span class="n">username</span><span class="o">))</span>
</span><span class='line'>              <span class="o">);</span>
</span><span class='line'>            <span class="o">})</span>
</span><span class='line'>          <span class="o">)</span>
</span><span class='line'>          <span class="o">.</span><span class="na">all</span><span class="o">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="n">ctx</span>
</span><span class='line'>            <span class="o">.</span><span class="na">byMethod</span><span class="o">(</span><span class="n">method</span> <span class="o">-&gt;</span> <span class="n">method</span>
</span><span class='line'>              <span class="o">.</span><span class="na">post</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">String</span> <span class="n">json</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getRequest</span><span class="o">().</span><span class="na">getBody</span><span class="o">().</span><span class="na">getText</span><span class="o">();</span>
</span><span class='line'>                <span class="n">ctx</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="s">&quot;Received request to create a new user with JSON: &quot;</span> <span class="o">+</span> <span class="n">json</span><span class="o">);</span>
</span><span class='line'>              <span class="o">})</span>
</span><span class='line'>              <span class="o">.</span><span class="na">get</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">ctx</span><span class="o">.</span><span class="na">render</span><span class="o">(</span><span class="s">&quot;Received request to list all users&quot;</span><span class="o">))</span>
</span><span class='line'>            <span class="o">)</span>
</span><span class='line'>          <span class="o">)</span>
</span><span class='line'>        <span class="o">)</span>
</span><span class='line'>      <span class="o">)</span>
</span><span class='line'>    <span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>唯一需要的修改是（1），我们通过一个显式的Registry实现提供了对Ratpack应用程序的定义。现在我们可以开始实现API层。</p>

<p>如果你仔细观察接下来的修改，就会理解Ratpack与传统的基于servlet的web应用是完全不同的。之前我们提及过，Ratpack的HTTP层构建在非阻塞的网络接口上，该web框架天然支持高性能。而基于servlet的web应用会为每个到来的请求产生一个新的线程，虽然会降低资源利用率，但每个请求处理流时是隔离的。在这种机制下，web应用处理请求时会采用阻塞式的方式，比如调用数据库并等待对应的结果然后返回，在等待期间（相对来说）并不关心这会影响它服务接下来的客户端的能力。在非阻塞式的web应用中，如果客户端或服务器端不发送数据，那么网络层并不会被阻塞，所以线程池中少量的“请求任务”线程就可以服务大量高并发的请求。然而这意味着如果应用程序代码阻塞了一个“请求任务”线程，那么吞吐量会显著影响。因此，阻塞操作（比如对数据库的操作）不能放置在请求线程中。</p>

<p>幸运的是，Ratpack通过在请求上下文中暴露一个阻塞接口来在应用程序中执行阻塞操作。该接口会把阻塞操作放置到另一个不同的线程池中，在维持高容量的情况服务新带来的请求的同时，这些阻塞调用也可以同步完成。一旦阻塞调用完成，处理流会返回到“请求任务”线程中，应答会被写回到客户端。在我们构建的API层中，我们要确保所有对UserRepository的操作都被路由到阻塞固定层中。列表9展示了API层的实现。</p>

<p>列表9</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">springpack</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.fasterxml.jackson.core.JsonProcessingException</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.fasterxml.jackson.core.type.TypeReference</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">ratpack.exec.Promise</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">ratpack.handling.Context</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">ratpack.server.RatpackServer</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">ratpack.spring.Spring</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">springpack.model.User</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">springpack.model.UserRepository</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">NOT_FOUND</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;()</span> <span class="err">\</span><span class="o">{</span><span class="err">\</span><span class="o">{</span>
</span><span class='line'>    <span class="n">put</span><span class="o">(</span><span class="s">&quot;status&quot;</span><span class="o">,</span> <span class="s">&quot;404&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">put</span><span class="o">(</span><span class="s">&quot;message&quot;</span><span class="o">,</span> <span class="s">&quot;NOT FOUND&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}};</span>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">NO_EMAIL</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;()</span> <span class="err">\</span><span class="o">{</span><span class="err">\</span><span class="o">{</span>
</span><span class='line'>    <span class="n">put</span><span class="o">(</span><span class="s">&quot;status&quot;</span><span class="o">,</span> <span class="s">&quot;400&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">put</span><span class="o">(</span><span class="s">&quot;message&quot;</span><span class="o">,</span> <span class="s">&quot;NO EMAIL ADDRESS SUPPLIED&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}};</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">RatpackServer</span><span class="o">.</span><span class="na">start</span><span class="o">(</span><span class="n">spec</span> <span class="o">-&gt;</span> <span class="n">spec</span>
</span><span class='line'>      <span class="o">.</span><span class="na">registry</span><span class="o">(</span><span class="n">Spring</span><span class="o">.</span><span class="na">spring</span><span class="o">(</span><span class="n">SpringBootConfig</span><span class="o">.</span><span class="na">class</span><span class="o">))</span>
</span><span class='line'>      <span class="o">.</span><span class="na">handlers</span><span class="o">(</span><span class="n">chain</span> <span class="o">-&gt;</span> <span class="n">chain</span>
</span><span class='line'>        <span class="o">.</span><span class="na">prefix</span><span class="o">(</span><span class="s">&quot;api/users&quot;</span><span class="o">,</span> <span class="n">pchain</span> <span class="o">-&gt;</span> <span class="n">pchain</span>
</span><span class='line'>          <span class="o">.</span><span class="na">prefix</span><span class="o">(</span><span class="s">&quot;:username&quot;</span><span class="o">,</span> <span class="n">uchain</span> <span class="o">-&gt;</span> <span class="n">uchain</span>
</span><span class='line'>            <span class="o">.</span><span class="na">all</span><span class="o">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class='line'>              <span class="c1">// extract the &quot;username&quot; path variable</span>
</span><span class='line'>              <span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getPathTokens</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;username&quot;</span><span class="o">);</span>
</span><span class='line'>              <span class="c1">// pull the UserRepository out of the registry</span>
</span><span class='line'>              <span class="n">UserRepository</span> <span class="n">userRepository</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">UserRepository</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>              <span class="c1">// pull the Jackson ObjectMapper out of the registry</span>
</span><span class='line'>              <span class="n">ObjectMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ObjectMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>              <span class="c1">// construct a &quot;promise&quot; for the requested user object. This will</span>
</span><span class='line'>              <span class="c1">// be subscribed to within the respective handlers, according to what</span>
</span><span class='line'>              <span class="c1">// they must do. The promise uses the &quot;blocking&quot; fixture to ensure</span>
</span><span class='line'>              <span class="c1">// the DB call doesn&#39;t take place on a &quot;request taking&quot; thread.</span>
</span><span class='line'>              <span class="n">Promise</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="n">userPromise</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">blocking</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">findByUsername</span><span class="o">(</span><span class="n">username</span><span class="o">));</span>
</span><span class='line'>              <span class="n">ctx</span><span class="o">.</span><span class="na">byMethod</span><span class="o">(</span><span class="n">method</span> <span class="o">-&gt;</span> <span class="n">method</span>
</span><span class='line'>                <span class="o">.</span><span class="na">get</span><span class="o">(()</span> <span class="o">-&gt;</span>
</span><span class='line'>                  <span class="c1">// the .then() block will &quot;subscribe&quot; to the result, allowing</span>
</span><span class='line'>                  <span class="c1">// us to send the user domain object back to the client</span>
</span><span class='line'>                  <span class="n">userPromise</span><span class="o">.</span><span class="na">then</span><span class="o">(</span><span class="n">user</span> <span class="o">-&gt;</span> <span class="n">sendUser</span><span class="o">(</span><span class="n">ctx</span><span class="o">,</span> <span class="n">user</span><span class="o">))</span>
</span><span class='line'>                <span class="o">)</span>
</span><span class='line'>                <span class="o">.</span><span class="na">put</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class='line'>                  <span class="c1">// Read the JSON from the request</span>
</span><span class='line'>                  <span class="n">String</span> <span class="n">json</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getRequest</span><span class="o">().</span><span class="na">getBody</span><span class="o">().</span><span class="na">getText</span><span class="o">();</span>
</span><span class='line'>                  <span class="c1">// Parse out the JSON body into a Map</span>
</span><span class='line'>                  <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">body</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">readValue</span><span class="o">(</span><span class="n">json</span><span class="o">,</span> <span class="k">new</span> <span class="n">TypeReference</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>
</span><span class='line'>                  <span class="o">});</span>
</span><span class='line'>                  <span class="c1">// Check to make sure the request body contained an &quot;email&quot; address</span>
</span><span class='line'>                  <span class="k">if</span> <span class="o">(</span><span class="n">body</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="s">&quot;email&quot;</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">userPromise</span>
</span><span class='line'>                      <span class="c1">// map the new email address on to the user entity</span>
</span><span class='line'>                      <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">user</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class='line'>                        <span class="n">user</span><span class="o">.</span><span class="na">setEmail</span><span class="o">(</span><span class="n">body</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;email&quot;</span><span class="o">));</span>
</span><span class='line'>                        <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
</span><span class='line'>                      <span class="o">})</span>
</span><span class='line'>                      <span class="c1">// and use the blocking thread pool to save the updated details</span>
</span><span class='line'>                      <span class="o">.</span><span class="na">blockingMap</span><span class="o">(</span><span class="nl">userRepository:</span><span class="o">:</span><span class="n">save</span><span class="o">)</span>
</span><span class='line'>                      <span class="c1">// finally, send the updated user entity back to the client</span>
</span><span class='line'>                      <span class="o">.</span><span class="na">then</span><span class="o">(</span><span class="n">u1</span> <span class="o">-&gt;</span> <span class="n">sendUser</span><span class="o">(</span><span class="n">ctx</span><span class="o">,</span> <span class="n">u1</span><span class="o">));</span>
</span><span class='line'>                  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>                    <span class="c1">// bad request; we didn&#39;t get an email address</span>
</span><span class='line'>                    <span class="n">ctx</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">status</span><span class="o">(</span><span class="mi">400</span><span class="o">);</span>
</span><span class='line'>                    <span class="n">ctx</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">send</span><span class="o">(</span><span class="n">mapper</span><span class="o">.</span><span class="na">writeValueAsBytes</span><span class="o">(</span><span class="n">NO_EMAIL</span><span class="o">));</span>
</span><span class='line'>                  <span class="o">}</span>
</span><span class='line'>                <span class="o">})</span>
</span><span class='line'>                <span class="o">.</span><span class="na">delete</span><span class="o">(()</span> <span class="o">-&gt;</span>
</span><span class='line'>                  <span class="n">userPromise</span>
</span><span class='line'>                    <span class="c1">// make the DB delete call in a blocking thread</span>
</span><span class='line'>                    <span class="o">.</span><span class="na">blockingMap</span><span class="o">(</span><span class="n">user</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class='line'>                      <span class="n">userRepository</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
</span><span class='line'>                      <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>                    <span class="o">})</span>
</span><span class='line'>                    <span class="c1">// then send a 204 back to the client</span>
</span><span class='line'>                    <span class="o">.</span><span class="na">then</span><span class="o">(</span><span class="n">user</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class='line'>                      <span class="n">ctx</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">status</span><span class="o">(</span><span class="mi">204</span><span class="o">);</span>
</span><span class='line'>                      <span class="n">ctx</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">send</span><span class="o">();</span>
</span><span class='line'>                    <span class="o">})</span>
</span><span class='line'>                <span class="o">)</span>
</span><span class='line'>              <span class="o">);</span>
</span><span class='line'>            <span class="o">})</span>
</span><span class='line'>          <span class="o">)</span>
</span><span class='line'>          <span class="o">.</span><span class="na">all</span><span class="o">(</span><span class="n">ctx</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class='line'>            <span class="c1">// pull the UserRepository out of the registry</span>
</span><span class='line'>            <span class="n">UserRepository</span> <span class="n">userRepository</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">UserRepository</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>            <span class="c1">// pull the Jackson ObjectMapper out of the registry</span>
</span><span class='line'>            <span class="n">ObjectMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ObjectMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>            <span class="n">ctx</span><span class="o">.</span><span class="na">byMethod</span><span class="o">(</span><span class="n">method</span> <span class="o">-&gt;</span> <span class="n">method</span>
</span><span class='line'>              <span class="o">.</span><span class="na">post</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class='line'>                <span class="c1">// read the JSON request body...</span>
</span><span class='line'>                <span class="n">String</span> <span class="n">json</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="na">getRequest</span><span class="o">().</span><span class="na">getBody</span><span class="o">().</span><span class="na">getText</span><span class="o">();</span>
</span><span class='line'>                <span class="c1">// ... and convert it into a user entity</span>
</span><span class='line'>                <span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">readValue</span><span class="o">(</span><span class="n">json</span><span class="o">,</span> <span class="n">User</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>                <span class="c1">// save the user entity on a blocking thread and</span>
</span><span class='line'>                <span class="c1">// render the user entity back to the client</span>
</span><span class='line'>                <span class="n">ctx</span><span class="o">.</span><span class="na">blocking</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">userRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">))</span>
</span><span class='line'>                  <span class="o">.</span><span class="na">then</span><span class="o">(</span><span class="n">u1</span> <span class="o">-&gt;</span> <span class="n">sendUser</span><span class="o">(</span><span class="n">ctx</span><span class="o">,</span> <span class="n">u1</span><span class="o">));</span>
</span><span class='line'>              <span class="o">})</span>
</span><span class='line'>              <span class="o">.</span><span class="na">get</span><span class="o">(()</span> <span class="o">-&gt;</span>
</span><span class='line'>                <span class="c1">// make the DB call, on a blocking thread, to list all users</span>
</span><span class='line'>                <span class="n">ctx</span><span class="o">.</span><span class="na">blocking</span><span class="o">(</span><span class="nl">userRepository:</span><span class="o">:</span><span class="n">findAll</span><span class="o">)</span>
</span><span class='line'>                  <span class="c1">// and render the user list back to the client</span>
</span><span class='line'>                  <span class="o">.</span><span class="na">then</span><span class="o">(</span><span class="n">users</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span><span class='line'>                    <span class="n">ctx</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">contentType</span><span class="o">(</span><span class="s">&quot;application/json&quot;</span><span class="o">);</span>
</span><span class='line'>                    <span class="n">ctx</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">send</span><span class="o">(</span><span class="n">mapper</span><span class="o">.</span><span class="na">writeValueAsBytes</span><span class="o">(</span><span class="n">users</span><span class="o">));</span>
</span><span class='line'>                  <span class="o">})</span>
</span><span class='line'>              <span class="o">)</span>
</span><span class='line'>            <span class="o">);</span>
</span><span class='line'>          <span class="o">})</span>
</span><span class='line'>        <span class="o">)</span>
</span><span class='line'>      <span class="o">)</span>
</span><span class='line'>    <span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">notFound</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">ObjectMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ObjectMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>    <span class="n">context</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">status</span><span class="o">(</span><span class="mi">404</span><span class="o">);</span>
</span><span class='line'>    <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">context</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">send</span><span class="o">(</span><span class="n">mapper</span><span class="o">.</span><span class="na">writeValueAsBytes</span><span class="o">(</span><span class="n">NOT_FOUND</span><span class="o">));</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JsonProcessingException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">context</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">send</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">sendUser</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">user</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">notFound</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">ObjectMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ObjectMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'>    <span class="n">context</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">contentType</span><span class="o">(</span><span class="s">&quot;application/json&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">context</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">send</span><span class="o">(</span><span class="n">mapper</span><span class="o">.</span><span class="na">writeValueAsBytes</span><span class="o">(</span><span class="n">user</span><span class="o">));</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JsonProcessingException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">context</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">status</span><span class="o">(</span><span class="mi">500</span><span class="o">);</span>
</span><span class='line'>      <span class="n">context</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">send</span><span class="o">(</span><span class="s">&quot;Error serializing user to JSON&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>API层最值得关注的点是对阻塞机制的使用，这次阻塞操作可以从每个请求的Conext对象中抽取出来。当调用ctx.blocking()方法时，会返回一个Promise对象，我们必须订阅该对象以便执行代码。我们可以抽取一个promise（在prefix(“:username”)中展示的一样）从而在不同的处理器中重用，保持代码简洁。</p>

<p>现在实现了API后，可以运行一系列curl测试来确保该微服务符合预期：</p>

<ul>
<li>命令: curl -d &lsquo;{&ldquo;username&rdquo;: &ldquo;dan&rdquo;, &ldquo;email&rdquo;: &ldquo;<a href="&#x6d;&#97;&#105;&#108;&#x74;&#x6f;&#58;&#100;&#97;&#110;&#105;&#x65;&#x6c;&#x70;&#119;&#x6f;&#111;&#x64;&#115;&#x40;&#103;&#109;&#x61;&#x69;&#x6c;&#46;&#99;&#111;&#x6d;">&#100;&#x61;&#110;&#x69;&#x65;&#108;&#112;&#119;&#111;&#111;&#100;&#x73;&#x40;&#103;&#109;&#97;&#105;&#108;&#46;&#x63;&#111;&#109;</a>&rdquo;}&#8217;<a href="http://localhost:5050/api/users,">http://localhost:5050/api/users,</a> 期望结果: {&ldquo;id&rdquo;:1,&ldquo;username&rdquo;:&ldquo;dan&rdquo;,&ldquo;email&rdquo;:&ldquo;<a href="&#x6d;&#x61;&#x69;&#108;&#116;&#x6f;&#x3a;&#100;&#x61;&#x6e;&#x69;&#x65;&#108;&#112;&#119;&#x6f;&#111;&#100;&#x73;&#64;&#x67;&#109;&#97;&#105;&#108;&#46;&#99;&#x6f;&#109;">&#100;&#x61;&#x6e;&#x69;&#101;&#108;&#x70;&#119;&#x6f;&#x6f;&#x64;&#115;&#64;&#103;&#x6d;&#97;&#105;&#108;&#46;&#x63;&#x6f;&#x6d;</a>&rdquo;}</li>
<li>命令: curl <a href="http://localhost:5050/api/users,">http://localhost:5050/api/users,</a> 期望结果: [{&ldquo;id&rdquo;:1,&ldquo;username&rdquo;:&ldquo;dan&rdquo;,&ldquo;email&rdquo;:&ldquo;<a href="&#109;&#97;&#x69;&#108;&#116;&#111;&#58;&#x64;&#97;&#x6e;&#105;&#x65;&#108;&#x70;&#x77;&#111;&#x6f;&#100;&#x73;&#64;&#x67;&#109;&#97;&#105;&#108;&#x2e;&#99;&#x6f;&#109;">&#x64;&#97;&#110;&#x69;&#x65;&#x6c;&#112;&#x77;&#x6f;&#x6f;&#x64;&#115;&#64;&#x67;&#x6d;&#x61;&#105;&#x6c;&#46;&#x63;&#111;&#109;</a>&rdquo;}]</li>
<li>命令: curl -XPUT -d &lsquo;{ &ldquo;email&rdquo;: &ldquo;<a href="&#109;&#97;&#105;&#108;&#x74;&#x6f;&#58;&#100;&#x61;&#x6e;&#105;&#101;&#x6c;&#x2e;&#x70;&#x2e;&#x77;&#111;&#111;&#100;&#x73;&#64;&#x67;&#109;&#x61;&#105;&#x6c;&#x2e;&#x63;&#x6f;&#x6d;">&#x64;&#97;&#110;&#x69;&#x65;&#x6c;&#x2e;&#x70;&#x2e;&#119;&#x6f;&#x6f;&#x64;&#115;&#64;&#103;&#x6d;&#97;&#x69;&#108;&#x2e;&#x63;&#x6f;&#x6d;</a>&rdquo; }&#8217;<a href="http://localhost:5050/api/users/dan,">http://localhost:5050/api/users/dan,</a> 期望结果: {&ldquo;id&rdquo;:1,&ldquo;username&rdquo;:&ldquo;dan&rdquo;,&ldquo;email&rdquo;:&ldquo;<a href="&#x6d;&#x61;&#105;&#108;&#116;&#111;&#58;&#x64;&#97;&#110;&#105;&#x65;&#x6c;&#x2e;&#112;&#46;&#119;&#x6f;&#x6f;&#x64;&#x73;&#x40;&#103;&#x6d;&#97;&#x69;&#x6c;&#x2e;&#99;&#111;&#x6d;">&#x64;&#97;&#x6e;&#105;&#101;&#x6c;&#46;&#112;&#x2e;&#119;&#111;&#111;&#x64;&#115;&#64;&#103;&#109;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#x6f;&#109;</a>&rdquo;}</li>
<li>命令: curl <a href="http://localhost:5050/api/users/dan,">http://localhost:5050/api/users/dan,</a> 期望结果: {&ldquo;id&rdquo;:1,&ldquo;username&rdquo;:&ldquo;dan&rdquo;,&ldquo;email&rdquo;:&ldquo;<a href="&#x6d;&#97;&#x69;&#108;&#x74;&#x6f;&#x3a;&#100;&#x61;&#x6e;&#105;&#101;&#108;&#46;&#112;&#46;&#119;&#111;&#111;&#100;&#115;&#x40;&#103;&#109;&#97;&#x69;&#108;&#x2e;&#99;&#x6f;&#x6d;">&#x64;&#97;&#110;&#105;&#x65;&#108;&#x2e;&#x70;&#x2e;&#119;&#111;&#x6f;&#x64;&#115;&#x40;&#x67;&#x6d;&#97;&#x69;&#x6c;&#46;&#99;&#x6f;&#x6d;</a>&rdquo;}</li>
<li>命令: curl -XDELETE <a href="http://localhost:5050/api/users/dan,">http://localhost:5050/api/users/dan,</a> 期望结果: empty</li>
<li>命令: curl <a href="http://localhost:5050/api/users/dan,">http://localhost:5050/api/users/dan,</a> 期望结果: {&ldquo;message&rdquo;:&ldquo;NOT FOUND&rdquo;,&ldquo;status&rdquo;:&ldquo;404&rdquo;}</li>
</ul>


<p>通过上面的命令序列可以看出API层工作完全正确，我们拥有了一个完全正式的数据驱动的基于Ratpack和Spring Boot的微服务，并且使用了Spring Data JPA！</p>

<p>整个过程的最后一步是部署。部署的最简单方式是执行gradle installDist命令。这会打包应用程序以及整个运行时依赖到一个traball(.tar文件)和zip(.zip文件)存档文件中。它另外也会创建跨平台的启动脚本，可以在任何安装了Java 8的系统中启动我们的微服务。当installDist任务完成后，可以在项目的build/distributions目录中找到这些存档文件。</p>

<p>通过本文章你已经学会了如何利用Spring Boot提供的大量生态系统以及Ratpack提供的高性能特性来打造一个微服务应用程序。你可以使用该示例作为起点来构建JVM上原生支持云的数据驱动的微服务程序。</p>

<p>欢迎使用Ratpack和Srping Boot！</p>

<h3>关于作者</h3>

<p>Daniel Woods醉心于企业级Java、Groovy以及Grails开发。他在JVM软件开发领域拥有10余年的工作经验，并且乐于向开源项目（比如<a href="http://www.ratpack.io/">Grails</a>和<a href="http://www.ratpack.io/">Ratpack</a>）贡献他的经验。Dan曾在Gr8conf和SpringOne 2GX大会上做过演讲嘉宾，展示了他基于JVM的企业级应用程序架构的专业知识。</p>
</div>


  <footer>
    <p class="meta">
      
  


<span class="byline author vcard">Posted by <span class="fn">黄博文</span></span>



      








  


<time datetime="2016-02-23T16:47:48+08:00" pubdate data-updated="true">Feb 23<span>rd</span>, 2016</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/ratpack/'>Ratpack</a>
  
</span>


      

<span class="tags">
  
    <a class='tag' href='/blog/tags/ratpack/'>Ratpack</a>, <a class='tag' href='/blog/tags/spring-boot/'>Spring Boot</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2016/02/23/gradle-vs-maven/" title="Previous Post: Maven和Gradle对比">&laquo; Maven和Gradle对比</a>
      
      
        <a class="basic-alignment right" href="/blog/2016/03/01/use-socks5-to-access-website/" title="Next Post: 使用SOCKS5翻墙">使用SOCKS5翻墙 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <p>攻城狮，程序猿。目前就职于ThoughtWorks。</p>
</section>

<section>
  <h1>Tag Cloud</h1>
    <span id="tag-cloud"><embed type='application/x-shockwave-flash' src='/javascripts/tagcloud.swf'width='100%' height='250' bgcolor='#f2f2f2' id='tagcloudflash' name='tagcloudflash' quality='high' allowscriptaccess='always'flashvars="tcolor=0x333333&amp;tcolor2=0x333333&amp;hicolor=0x000000&amp;tspeed=100&amp;distr=true&amp;mode=tags&amp;tagcloud=%3Ctags%3E%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Facl%27+style%3D%27font-size%3A+50.0%25%27%3EACL%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Factivemq%27+style%3D%27font-size%3A+31.818181818181817%25%27%3EActiveMQ%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fagile%27+style%3D%27font-size%3A+20.909090909090907%25%27%3EAgile%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fagile%27+style%3D%27font-size%3A+13.636363636363637%25%27%3Eagile%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fandroid%27+style%3D%27font-size%3A+13.636363636363637%25%27%3EAndroid%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Faws%27+style%3D%27font-size%3A+35.45454545454545%25%27%3EAWS%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fblog%27+style%3D%27font-size%3A+13.636363636363637%25%27%3EBlog%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fc-%27+style%3D%27font-size%3A+13.636363636363637%25%27%3EC%23%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fchef%27+style%3D%27font-size%3A+13.636363636363637%25%27%3EChef%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fci%27+style%3D%27font-size%3A+20.909090909090907%25%27%3ECI%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fcloud%27+style%3D%27font-size%3A+42.72727272727273%25%27%3ECloud%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fcoding%27+style%3D%27font-size%3A+13.636363636363637%25%27%3ECoding%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fdatabase%27+style%3D%27font-size%3A+13.636363636363637%25%27%3EDataBase%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fdesign%27+style%3D%27font-size%3A+13.636363636363637%25%27%3Edesign%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fdevops%27+style%3D%27font-size%3A+24.545454545454547%25%27%3EDevOps%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fefficient%27+style%3D%27font-size%3A+13.636363636363637%25%27%3Eefficient%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fenglish%27+style%3D%27font-size%3A+13.636363636363637%25%27%3EEnglish%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Ffitness%27+style%3D%27font-size%3A+13.636363636363637%25%27%3Efitness%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Ffp%27+style%3D%27font-size%3A+13.636363636363637%25%27%3EFP%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fgatling%27+style%3D%27font-size%3A+13.636363636363637%25%27%3EGatling%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fgradle%27+style%3D%27font-size%3A+39.09090909090909%25%27%3EGradle%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fgrunt%27+style%3D%27font-size%3A+13.636363636363637%25%27%3EGrunt%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fhaskell%27+style%3D%27font-size%3A+13.636363636363637%25%27%3EHaskell%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fhomebrew%27+style%3D%27font-size%3A+13.636363636363637%25%27%3EHomebrew%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fjava%27+style%3D%27font-size%3A+20.909090909090907%25%27%3EJava%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fjava%27+style%3D%27font-size%3A+13.636363636363637%25%27%3Ejava%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fjavascript%27+style%3D%27font-size%3A+13.636363636363637%25%27%3EJavaScript%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fjava%E5%AD%A6%E4%B9%A0%27+style%3D%27font-size%3A+13.636363636363637%25%27%3EJava%E5%AD%A6%E4%B9%A0%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Flearning%27+style%3D%27font-size%3A+13.636363636363637%25%27%3Elearning%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Flife%27+style%3D%27font-size%3A+42.72727272727273%25%27%3ELife%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Flife%27+style%3D%27font-size%3A+17.272727272727273%25%27%3Elife%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Flife%27+style%3D%27font-size%3A+13.636363636363637%25%27%3ELIFE%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fmarathon%27+style%3D%27font-size%3A+17.272727272727273%25%27%3EMarathon%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fmicroservice%27+style%3D%27font-size%3A+13.636363636363637%25%27%3Emicroservice%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Foctopress%27+style%3D%27font-size%3A+13.636363636363637%25%27%3EOctopress%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fplugin%27+style%3D%27font-size%3A+13.636363636363637%25%27%3Eplugin%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fpractise%27+style%3D%27font-size%3A+13.636363636363637%25%27%3Epractise%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fprotractor%27+style%3D%27font-size%3A+13.636363636363637%25%27%3EProtractor%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fratpack%27+style%3D%27font-size%3A+13.636363636363637%25%27%3ERatpack%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Freading%27+style%3D%27font-size%3A+13.636363636363637%25%27%3Ereading%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Frefactor%27+style%3D%27font-size%3A+13.636363636363637%25%27%3Erefactor%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fruby%27+style%3D%27font-size%3A+13.636363636363637%25%27%3Eruby%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Frun%27+style%3D%27font-size%3A+13.636363636363637%25%27%3Erun%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Frun%27+style%3D%27font-size%3A+17.272727272727273%25%27%3ERun%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Frunning%27+style%3D%27font-size%3A+13.636363636363637%25%27%3Erunning%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fscala%27+style%3D%27font-size%3A+13.636363636363637%25%27%3EScala%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fshell%27+style%3D%27font-size%3A+13.636363636363637%25%27%3Eshell%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fsocks5%27+style%3D%27font-size%3A+13.636363636363637%25%27%3ESOCKS5%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fspring%27+style%3D%27font-size%3A+28.181818181818183%25%27%3ESpring%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fspring-context%27+style%3D%27font-size%3A+39.09090909090909%25%27%3ESpring-Context%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fspring-context%27+style%3D%27font-size%3A+13.636363636363637%25%27%3ESpring-context%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fstudy%27+style%3D%27font-size%3A+13.636363636363637%25%27%3Estudy%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fsummary%27+style%3D%27font-size%3A+13.636363636363637%25%27%3ESummary%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fsvn%27+style%3D%27font-size%3A+13.636363636363637%25%27%3ESVN%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Ftesting%27+style%3D%27font-size%3A+13.636363636363637%25%27%3Etesting%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Ftesting%27+style%3D%27font-size%3A+17.272727272727273%25%27%3ETesting%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Ftranslation%27+style%3D%27font-size%3A+13.636363636363637%25%27%3Etranslation%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fweb%27+style%3D%27font-size%3A+13.636363636363637%25%27%3EWEB%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fweibo%27+style%3D%27font-size%3A+13.636363636363637%25%27%3EWeibo%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fxml%27+style%3D%27font-size%3A+13.636363636363637%25%27%3EXML%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fxp%27+style%3D%27font-size%3A+13.636363636363637%25%27%3EXP%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2Fzsh%27+style%3D%27font-size%3A+13.636363636363637%25%27%3EZSH%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2F%E4%B8%AA%E4%BA%BA%E9%9A%8F%E7%AC%94%27+style%3D%27font-size%3A+13.636363636363637%25%27%3E%E4%B8%AA%E4%BA%BA%E9%9A%8F%E7%AC%94%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2F%E5%B7%A5%E5%85%B7%27+style%3D%27font-size%3A+13.636363636363637%25%27%3E%E5%B7%A5%E5%85%B7%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2F%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%27+style%3D%27font-size%3A+13.636363636363637%25%27%3E%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2F%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A%27+style%3D%27font-size%3A+13.636363636363637%25%27%3E%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2F%E6%80%BB%E7%BB%93%27+style%3D%27font-size%3A+17.272727272727273%25%27%3E%E6%80%BB%E7%BB%93%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2F%E6%89%80%E6%80%9D%E6%89%80%E5%BE%97%27+style%3D%27font-size%3A+13.636363636363637%25%27%3E%E6%89%80%E6%80%9D%E6%89%80%E5%BE%97%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2F%E6%89%80%E6%80%9D%E6%89%80%E6%83%B3%27+style%3D%27font-size%3A+13.636363636363637%25%27%3E%E6%89%80%E6%80%9D%E6%89%80%E6%83%B3%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2F%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%27+style%3D%27font-size%3A+13.636363636363637%25%27%3E%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2F%E7%94%9F%E6%B4%BB%27+style%3D%27font-size%3A+13.636363636363637%25%27%3E%E7%94%9F%E6%B4%BB%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2F%E7%94%9F%E6%B4%BB%E6%84%9F%E6%82%9F%27+style%3D%27font-size%3A+13.636363636363637%25%27%3E%E7%94%9F%E6%B4%BB%E6%84%9F%E6%82%9F%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2F%E7%94%9F%E6%B4%BB%E9%9A%8F%E7%AC%94%27+style%3D%27font-size%3A+24.545454545454547%25%27%3E%E7%94%9F%E6%B4%BB%E9%9A%8F%E7%AC%94%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2F%E7%A8%8B%E5%BA%8F%E8%AF%AD%E8%A8%80%27+style%3D%27font-size%3A+13.636363636363637%25%27%3E%E7%A8%8B%E5%BA%8F%E8%AF%AD%E8%A8%80%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2F%E7%BC%96%E7%A8%8B%E5%BC%80%E5%8F%91%27+style%3D%27font-size%3A+31.818181818181817%25%27%3E%E7%BC%96%E7%A8%8B%E5%BC%80%E5%8F%91%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2F%E7%BF%BB%E8%AF%91%27+style%3D%27font-size%3A+17.272727272727273%25%27%3E%E7%BF%BB%E8%AF%91%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2F%E8%AF%BB%E4%B9%A6%27+style%3D%27font-size%3A+13.636363636363637%25%27%3E%E8%AF%BB%E4%B9%A6%3C%2Fa%3E+%3Ca+href%3D%27http%3A%2F%2Fwww.huangbowen.net%2Fblog%2Fcategories%2F%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%27+style%3D%27font-size%3A+17.272727272727273%25%27%3E%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%3C%2Fa%3E+%3C%2Ftags%3E"></span>
</section>

<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/02/23/alibaba-java-code-style/">阿里巴巴Java开发手册评述</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/01/20/summary-for-2016/">一个程序员的2016年总结</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/01/19/the-object-oriented-thought-process/">面向对象的思考过程第四版译者序</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/01/11/operate-the-university-using-agile/">以敏捷的方式运作一所大学</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/20/qa-in-agile-team/">敏捷团队中的QA由来</a>
      </li>
    
  </ul>
</section>

<iframe width="100%" height="550" class="share_self" frameborder="0" scrolling="no"
        src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=1&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=2246154347&verifier=149f357d&dpc=1"></iframe>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - 黄博文 -
  huangbowen521@gmail.com
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'bowenhuang';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.huangbowen.net/blog/2016/02/23/ratpack-and-spring-boot/';
        var disqus_url = 'http://www.huangbowen.net/blog/2016/02/23/ratpack-and-spring-boot/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
